<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendário de Reservas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      background-color: #f5f5f5;
    }

    h1 {
      margin-bottom: 20px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 600px;
      background-color: white;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    th,
    td {
      border: 1px solid #ddd;
      text-align: center;
      padding: 10px;
    }

    th {
      background-color: #f2f2f2;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      max-width: 600px;
      margin-bottom: 10px;
    }

    .btn {
      padding: 5px 10px;
      cursor: pointer;
    }

    .today {
      background-color: #cfe3ff;
    }

    .unavailable {
      background-color: #ffcccc;
    }

    .price {
      display: block;
      font-size: 0.8em;
      color: #333;
    }
  </style>
</head>

<body>
  <h1>Calendário de Reservas</h1>
  <div class="header">
    <button class="btn" onclick="changeMonth(-1)">&lt; Anterior</button>
    <h2 id="monthYear"></h2>
    <button class="btn" onclick="changeMonth(1)">Próximo &gt;</button>
  </div>
  <table id="calendar"></table>

  <script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRbZUZD_RuGjPaw7LhV1bJzQT0tX7vndih4VuOlm4pEJ6LktEgiyL7p-fiXh2iewxX3-WpqkB4iaFIL/pub?output=csv';

    let currentDate = new Date();
    let availability = {};
    let prices = {};

    async function loadCSVData() {
      const response = await fetch(csvUrl);
      const data = await response.text();
      const rows = data.split('\n').slice(1); // remove header

      rows.forEach(row => {
        const [dataCell, disponivel, valor] = row.split(',');
        if (dataCell) {
          const dateKey = new Date(dataCell.trim()).toISOString().split('T')[0];
          availability[dateKey] = disponivel.trim().toLowerCase() !== 'não';
          prices[dateKey] = parseFloat(valor.replace('R$', '').replace(',', '.')) || null;
        }
      });

      renderCalendar();
    }

    function changeMonth(monthOffset) {
      currentDate.setMonth(currentDate.getMonth() + monthOffset);
      renderCalendar();
    }

    function renderCalendar() {
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';

      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDay = firstDay.getDay();

      document.getElementById('monthYear').innerText = `${firstDay.toLocaleString('pt-BR', {
        month: 'long', year: 'numeric'
      })}`;

      const headerRow = document.createElement('tr');
      ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'].forEach(day => {
        const th = document.createElement('th');
        th.innerText = day;
        headerRow.appendChild(th);
      });
      calendar.appendChild(headerRow);

      let row = document.createElement('tr');
      for (let i = 0; i < startDay; i++) {
        const cell = document.createElement('td');
        row.appendChild(cell);
      }

      for (let day = 1; day <= lastDay.getDate(); day++) {
        const date = new Date(year, month, day);
        const dateKey = date.toISOString().split('T')[0];
        const cell = document.createElement('td');
        cell.innerText = day;

        if (date.toDateString() === new Date().toDateString()) {
          cell.classList.add('today');
        }

        if (availability[dateKey] === false) {
          cell.classList.add('unavailable');
        }

        if (prices[dateKey]) {
          const priceSpan = document.createElement('span');
          priceSpan.className = 'price';
          priceSpan.innerText = `R$ ${prices[dateKey].toFixed(2)}`;
          cell.appendChild(document.createElement('br'));
          cell.appendChild(priceSpan);
        }

        row.appendChild(cell);

        if (date.getDay() === 6) {
          calendar.appendChild(row);
          row = document.createElement('tr');
        }
      }

      if (row.children.length > 0) {
        while (row.children.length < 7) {
          row.appendChild(document.createElement('td'));
        }
        calendar.appendChild(row);
      }
    }

    loadCSVData();
  </script>
</body>

</html>
